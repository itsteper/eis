SELECT t.code, t.ACCOUNT_NUMBER, t.TARIFF_MONTH, t.ACCOUNT_DATE, t.TOTAL_SUMM, t.STATUS_NAME, t.ACCTNUMBER, decode(t.style1,5,t.style||';f=b',6,t.style||';f=b',t.style) AS style FROM (
SELECT CODE,
       ACCOUNT_NUMBER,
       TO_CHAR(TARIFF_MONTH,'MM/YYYY') AS TARIFF_MONTH,
       decode(grouping(TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')),1,'Всего',TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')) AS ACCOUNT_DATE,
       SUM(CASE_SERVICES_ACCOUNTS.TOTAL_SUMM) AS TOTAL_SUMM,
       STATUS_NAME,
       ACCTNUMBER,
       grouping(CODE) + 
       grouping(ACCOUNT_NUMBER) + 
       grouping(TO_CHAR(TARIFF_MONTH,'MM/YYYY')) + 
       grouping(TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')) + 
       grouping(STATUS_NAME) + 
       grouping(ACCTNUMBER) AS style1
      ,'5:cf=#/##0.00,a=r' AS style
  FROM CASE_SERVICES_ACCOUNTS@EISSTAC,
       SMO@EISSTAC,
       VMU_ACC_STATUS@EISSTAC,
       JOINTACCTSDATA@EISSTAC,
       JOINTACCTS@EISSTAC
 WHERE ID_PAYER = ID_SMO
   AND CASE_SERVICES_ACCOUNTS.ID_STATUS = VMU_ACC_STATUS.ID_STATUS
   AND CASE_SERVICES_ACCOUNTS.ID_ACCOUNT = JOINTACCTSDATA.ACCTID(+)
   AND JOINTACCTSDATA.JOINACCTID = JOINTACCTS.ID(+)
   AND (ID_SMO = :ID_SMO OR :ID_SMO IS NULL)
   AND (CASE_SERVICES_ACCOUNTS.ID_STATUS = :ID_STATUS OR :ID_STATUS IS NULL)
   AND CASE_SERVICES_ACCOUNTS.ACCOUNT_DATE >= :ACCT_DAT_FROM
   AND CASE_SERVICES_ACCOUNTS.ACCOUNT_DATE <= :ACCT_DAT_TO
/*   AND CASE_SERVICES_ACCOUNTS.TARIFF_MONTH >= 'DATEMONTH1'
   AND CASE_SERVICES_ACCOUNTS.TARIFF_MONTH <= 'DATEMONTH2'*/
/*   AND JOINTACCTS.ACCTBEGINDATE >= 'DATESV1'
   AND JOINTACCTS.ACCTBEGINDATE <= 'DATESV2'*/
 GROUP BY rollup(CODE,
       ACCOUNT_NUMBER,
       TO_CHAR(TARIFF_MONTH,'MM/YYYY'),
       TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY'),
       STATUS_NAME,
       ACCTNUMBER)
 ORDER BY CODE, ACCOUNT_NUMBER) t
WHERE t.style1 IN (0, 5, 6)
