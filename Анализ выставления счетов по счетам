SELECT t.code, t.ACCOUNT_NUMBER, t.TARIFF_MONTH, t.ACCOUNT_DATE, t.TOTAL_SUMM, t.STATUS_NAME, t.ACCTNUMBER, po_number, po_date, decode(t.style1,5,t.style||';f=b',6,t.style||';f=b',t.style) AS style FROM (
SELECT CODE,
       ACCOUNT_NUMBER,
       TO_CHAR(TARIFF_MONTH,'MM/YYYY') AS TARIFF_MONTH,
       decode(grouping(TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')),1,'Всего',TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')) AS ACCOUNT_DATE,
       SUM(CASE_SERVICES_ACCOUNTS.TOTAL_SUMM) AS TOTAL_SUMM,
       STATUS_NAME,
       ACCTNUMBER,
       grouping(CODE) + 
       grouping(ACCOUNT_NUMBER) + 
       grouping(TO_CHAR(TARIFF_MONTH,'MM/YYYY')) + 
       grouping(TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY')) + 
       grouping(STATUS_NAME) + 
       grouping(ACCTNUMBER) AS style1
      ,'5:cf=#/##0.00,a=r' AS style,
       psh.pay_number AS po_number,
       TO_CHAR(psh.execute_date, 'dd.mm.yyyy') AS po_date
  FROM CASE_SERVICES_ACCOUNTS@EISSTAC,
       SMO@EISSTAC,
       VMU_ACC_STATUS@EISSTAC,
       JOINTACCTSDATA@EISSTAC,
       JOINTACCTS@EISSTAC,
       pay_sheets@eisstac psh,
       pay_summs@eisstac ps
 WHERE ID_PAYER = ID_SMO
   AND CASE_SERVICES_ACCOUNTS.ID_STATUS = VMU_ACC_STATUS.ID_STATUS
   AND CASE_SERVICES_ACCOUNTS.ID_ACCOUNT = JOINTACCTSDATA.ACCTID(+)
   AND JOINTACCTSDATA.JOINACCTID = JOINTACCTS.ID(+)
   AND (ID_SMO = '' OR '' IS NULL)
   AND (CASE_SERVICES_ACCOUNTS.ID_STATUS = '' OR '' IS NULL)
   AND psh.id_pay_calc = ps.id_pay_calc
   AND ps.id_account = CASE_SERVICES_ACCOUNTS.ID_ACCOUNT
   AND CASE_SERVICES_ACCOUNTS.ACCOUNT_DATE >= TO_DATE('2015-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')
   AND CASE_SERVICES_ACCOUNTS.ACCOUNT_DATE <= TO_DATE('2015-02-27 00:00:00', 'yyyy-mm-dd hh24:mi:ss')
   
/*   AND CASE_SERVICES_ACCOUNTS.TARIFF_MONTH >= 'DATEMONTH1'
   AND CASE_SERVICES_ACCOUNTS.TARIFF_MONTH <= 'DATEMONTH2'*/
/*   AND JOINTACCTS.ACCTBEGINDATE >= 'DATESV1'
   AND JOINTACCTS.ACCTBEGINDATE <= 'DATESV2'*/
   
GROUP BY rollup(CODE,
       ACCOUNT_NUMBER,
       TO_CHAR(TARIFF_MONTH,'MM/YYYY'),
       TO_CHAR(ACCOUNT_DATE,'DD.MM.YYYY'),
       STATUS_NAME,
       ACCTNUMBER,psh.pay_number,TO_CHAR(psh.execute_date, 'dd.mm.yyyy'))
 ORDER BY CODE, ACCOUNT_NUMBER) t
WHERE t.style1 IN (0, 5, 6)
